<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Show Sub-Categories</title>
    <link
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container">
      <h2 class="mt-5">Sub-Categories List</h2>

      <div class="card-body">
        
      <a href="add-supcategory.html" class="btn btn-success">Add New supcategory</a>
      <a href="TotalSupAndCatagory.html" class="btn btn-success">Back</a>
        <table class="table table-bordered mt-3">
          <thead>
            <tr>
              <th>Sub-Category ID</th>
              <th>Sub-Category Name</th>
              <th>Category ID</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="subCategoryList">
            <!-- Sub-categories will be loaded here -->
          </tbody>
        </table>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        fetch("http://localhost:5000/api/sub_category")
          .then((response) => response.json())
          .then((subCategories) => {
            const tableBody = document.getElementById("subCategoryList");
            subCategories.forEach((subCategory) => {
              const row = document.createElement("tr");
              row.innerHTML = `
                <td>${subCategory.Sub_Cat_Id}</td>
                <td>${subCategory.Sub_Cat_Name}</td>
                <td>${subCategory.Cat_Id}</td>
                <td>
                    <button class="btn btn-primary" onclick="editSubCategory(${subCategory.Sub_Cat_Id})">Edit</button>
                    <button class="btn btn-danger" onclick="deleteSubCategory(${subCategory.Sub_Cat_Id})">Delete</button>
                </td>`;
              tableBody.appendChild(row);
            });
          })
          .catch((error) =>
            console.error("Error loading sub-categories:", error)
          );
      });

      function editSubCategory(subCatId) {
        window.location.href = `edit-subcategory.html?id=${subCatId}`;
      }

      function deleteSubCategory(subCatId) {
        if (confirm("Are you sure you want to delete this sub-category?")) {
          fetch(`http://localhost:5000/api/sub_category/${subCatId}`, {
            method: "DELETE",
          })
            .then((response) => {
              if (!response.ok)
                throw new Error("Failed to delete sub-category.");
              alert("Sub-category deleted successfully.");
              location.reload();
            })
            .catch((error) => {
              alert("Error deleting sub-category: " + error.message);
            });
        }
      }

    </script>
  </body>
</html>
